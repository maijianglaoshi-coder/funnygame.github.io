<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <title>ç­çº§ç§¯åˆ†ç³»ç»Ÿ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Safariç‰¹å®šä¼˜åŒ– */
        body {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: 100%;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            overflow-x: hidden;
        }
        
        /* è§¦æ‘¸å‹å¥½çš„æŒ‰é’®æ ·å¼ */
        .touch-button {
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            -webkit-appearance: none;
        }
        
        /* è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        .bounce {
            animation: bounce 1s;
        }
        
        /* å­¦ç”Ÿå¡ç‰‡æ‚¬åœæ•ˆæœ */
        .student-card {
            transition: all 0.3s ease;
        }
        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        /* ç­çº§å¡ç‰‡æ ·å¼ */
        .class-card {
            transition: all 0.3s ease;
        }
        .class-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* åˆ†ç»„å¡ç‰‡æ ·å¼ */
        .group-card {
            transition: all 0.3s ease;
        }
        .group-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        /* iPad Safariä¼˜åŒ–å¸ƒå±€ */
        @media (max-width: 1024px) {
            .student-card {
                min-height: 180px;
            }
            
            .menu-button {
                padding: 12px 16px;
                font-size: 16px;
            }
        }
        
        /* é˜²æ­¢iOSç¼©æ”¾å’Œè¡¨å•æ ·å¼é—®é¢˜ */
        input, select, textarea {
            font-size: 16px !important;
            border-radius: 8px;
            -webkit-appearance: none;
        }
        
        /* Safariä¸‹æ‹‰ç®­å¤´æ ·å¼ä¿®å¤ */
        select {
            background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 40px;
        }
        
        /* æ¨¡æ€æ¡†ä¼˜åŒ– */
        .modal-container {
            max-height: 85vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* æŒ‰é’®æ¿€æ´»çŠ¶æ€ */
        button:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
        
        /* é˜²æ­¢é•¿æŒ‰èœå• */
        * {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
        }
        
        /* å…è®¸è¾“å…¥æ¡†é€‰æ‹©æ–‡æœ¬ */
        input, textarea {
            -webkit-user-select: text;
        }
        
        /* éšæœºç‚¹ååŠ¨ç”» */
        @keyframes randomCall {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .random-call-animation {
            animation: randomCall 0.5s infinite;
        }
        
        /* é«˜äº®é€‰ä¸­å­¦ç”Ÿ */
        .selected-student {
            background-color: #fef3c7;
            border: 2px solid #f59e0b;
            transform: scale(1.05);
        }
        
        /* åˆ†ç»„é¢œè‰² */
        .group-1 { border-left: 4px solid #3b82f6; }
        .group-2 { border-left: 4px solid #ef4444; }
        .group-3 { border-left: 4px solid #10b981; }
        .group-4 { border-left: 4px solid #f59e0b; }
        .group-5 { border-left: 4px solid #8b5cf6; }
        .group-6 { border-left: 4px solid #06b6d4; }
        
        /* é€‰é¡¹å¡æ ·å¼ */
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }
        
        /* å†å²è®°å½•æ ·å¼ */
        .history-item {
            border-left: 3px solid #ef4444;
            padding-left: 12px;
            margin-bottom: 10px;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <!-- åŠ è½½ç•Œé¢ -->
    <div id="loadingScreen" class="fixed inset-0 bg-white flex items-center justify-center z-50">
        <div class="text-center">
            <div class="loader mx-auto mb-4"></div>
            <h2 class="text-xl font-bold text-blue-600">ç­çº§ç§¯åˆ†ç³»ç»Ÿ</h2>
            <p class="text-gray-500 mt-2">åŠ è½½ä¸­...</p>
        </div>
    </div>
    
    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="app" class="container mx-auto px-4 py-6 hidden">
        <!-- æ ‡é¢˜å’Œç­çº§é€‰æ‹© -->
        <div class="flex flex-col md:flex-row justify-between items-center mb-8">
            <h1 id="classTitle" class="text-3xl md:text-4xl font-bold text-blue-600 inline-flex items-center mb-4 md:mb-0">
                ç­çº§ç§¯åˆ†ç³»ç»Ÿ
                <span class="ml-2 text-yellow-500">âœ¨</span>
            </h1>
            
            <div class="flex items-center space-x-2">
                <select id="classSelector" class="bg-white border border-gray-300 rounded-lg px-4 py-3 text-lg focus:outline-none focus:ring-2 focus:ring-blue-500 touch-button">
                    <!-- ç­çº§é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </select>
                <button id="manageClasses" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg touch-button">
                    <i class="fas fa-cog mr-2"></i> ç®¡ç†
                </button>
            </div>
        </div>
        
        <!-- èœå•æ  -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-8">
            <div class="flex flex-wrap justify-center gap-3">
                <!-- å…¨ç­åŠ åˆ†æŒ‰é’® -->
                <button id="addAllPoints" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-users mr-2"></i>å…¨ç­åŠ åˆ†
                </button>
                
                <!-- å…¨ç­æ¸…é›¶æŒ‰é’® -->
                <button id="resetAllPoints" class="bg-red-500 hover:bg-red-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-undo mr-2"></i>å…¨ç­æ¸…é›¶
                </button>
                
                <!-- æ’è¡Œæ¦œæŒ‰é’® -->
                <button id="showRanking" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-trophy mr-2"></i>æ’è¡Œæ¦œ
                </button>
                
                <!-- å¯¼å…¥ç§¯åˆ†æŒ‰é’® -->
                <button id="importPoints" class="bg-green-500 hover:bg-green-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-file-import mr-2"></i>å¯¼å…¥
                </button>
                
                <!-- å¯¼å‡ºç§¯åˆ†æŒ‰é’® -->
                <button id="exportPoints" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-file-export mr-2"></i>å¯¼å‡º
                </button>
                
                <!-- æ·»åŠ å­¦ç”ŸæŒ‰é’® -->
                <button id="addStudent" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-user-plus mr-2"></i>æ·»åŠ 
                </button>
                
                <!-- æ‰¹é‡æ·»åŠ å­¦ç”ŸæŒ‰é’® -->
                <button id="batchAddStudents" class="bg-teal-500 hover:bg-teal-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-users mr-2"></i>æ‰¹é‡
                </button>
                
                <!-- éšæœºç‚¹åæŒ‰é’® -->
                <button id="randomCall" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-random mr-2"></i>éšæœºç‚¹å
                </button>
                
                <!-- åˆ†ç»„ç®¡ç†æŒ‰é’® -->
                <button id="manageGroups" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-object-group mr-2"></i>åˆ†ç»„ç®¡ç†
                </button>
                
                <!-- å†å²è®°å½•æŒ‰é’® -->
                <button id="showHistory" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-3 rounded-lg transition flex items-center text-lg menu-button touch-button">
                    <i class="fas fa-history mr-2"></i>å†å²è®°å½•
                </button>
            </div>
        </div>
        
        <!-- è§†å›¾åˆ‡æ¢é€‰é¡¹å¡ -->
        <div class="flex mb-4 bg-white rounded-lg p-1 shadow-sm">
            <button id="viewAll" class="flex-1 py-3 rounded-lg tab-button active touch-button" data-view="all">
                <i class="fas fa-users mr-2"></i>å…¨éƒ¨å­¦ç”Ÿ
            </button>
            <button id="viewByGroup" class="flex-1 py-3 rounded-lg tab-button touch-button" data-view="group">
                <i class="fas fa-object-group mr-2"></i>æŒ‰ç»„æŸ¥çœ‹
            </button>
        </div>
        
        <!-- å­¦ç”Ÿæ“ä½œç½‘æ ¼ -->
        <div id="studentGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 mb-8">
            <!-- å­¦ç”Ÿå¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <!-- åˆ†ç»„è§†å›¾ -->
        <div id="groupView" class="hidden mb-8">
            <div id="groupsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- åˆ†ç»„å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
        
        <!-- æç¤ºä¿¡æ¯ -->
        <div id="message" class="fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 hidden text-lg"></div>
        
        <!-- é¡µè„š -->
        <footer class="text-center text-gray-500 mt-12 pb-6">
            <p>ç­çº§ç§¯åˆ†ç³»ç»Ÿ &copy; 2023 - ä¸“ä¸ºæ•™å¸ˆè®¾è®¡</p>
            <p class="text-sm mt-2">æ•°æ®ä¿å­˜åœ¨æœ¬åœ°æµè§ˆå™¨ä¸­ï¼Œåˆ·æ–°é¡µé¢ä¸ä¼šä¸¢å¤±</p>
        </footer>
    </div>
    
    <!-- æ¨¡æ€æ¡†åŒºåŸŸ -->
    <!-- å…¨ç­åŠ åˆ†æ¨¡æ€æ¡† -->
    <div id="addAllPointsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">å…¨ç­åŠ åˆ†</h3>
            <p class="mb-4 text-gray-600">è¯·è¾“å…¥è¦å¢åŠ çš„åˆ†æ•°ï¼š</p>
            <input type="number" id="pointsInput" class="w-full p-4 border border-gray-300 rounded-lg mb-4 text-lg" value="1" min="1">
            <div class="flex justify-end gap-2">
                <button id="cancelAddAllPoints" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å–æ¶ˆ</button>
                <button id="confirmAddAllPoints" class="px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition text-lg touch-button">ç¡®å®š</button>
            </div>
        </div>
    </div>
    
    <!-- æ‰£åˆ†åŸå› æ¨¡æ€æ¡† -->
    <div id="deductPointsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">æ‰£åˆ†åŸå› </h3>
            <p class="mb-4 text-gray-600">è¯·é€‰æ‹©æˆ–è¾“å…¥æ‰£åˆ†åŸå› ï¼š</p>
            <div class="mb-4">
                <label class="block text-gray-700 mb-2">å¿«é€Ÿé€‰æ‹©ï¼š</label>
                <div class="grid grid-cols-1 gap-2 mb-4">
                    <button class="quick-reason px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-left" data-reason="à¹„à¸¡à¹ˆà¸¡à¸µà¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸™">
                        <i class="fas fa-pencil-alt mr-2 text-blue-500"></i>à¹„à¸¡à¹ˆà¸¡à¸µà¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸™
                    </button>
                    <button class="quick-reason px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-left" data-reason="à¹„à¸¡à¹ˆà¹€à¸„à¸²à¸£à¸à¸à¸•à¸´à¸à¸²">
                        <i class="fas fa-gavel mr-2 text-red-500"></i>à¹„à¸¡à¹ˆà¹€à¸„à¸²à¸£à¸à¸à¸•à¸´à¸à¸²
                    </button>
                    <button class="quick-reason px-4 py-3 bg-gray-100 hover:bg-gray-200 rounded-lg text-left" data-reason="à¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡à¸‡à¸²à¸™">
                        <i class="fas fa-book mr-2 text-green-500"></i>à¹„à¸¡à¹ˆà¸ªà¹ˆà¸‡à¸‡à¸²à¸™
                    </button>
                </div>
                <label class="block text-gray-700 mb-2">è‡ªå®šä¹‰åŸå› ï¼š</label>
                <textarea id="deductReason" class="w-full p-3 border border-gray-300 rounded-lg text-lg" placeholder="è¯·è¾“å…¥å…¶ä»–æ‰£åˆ†åŸå› "></textarea>
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancelDeductPoints" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å–æ¶ˆ</button>
                <button id="confirmDeductPoints" class="px-4 py-3 bg-red-500 hover:bg-red-600 text-white rounded-lg transition text-lg touch-button">ç¡®è®¤æ‰£åˆ†</button>
            </div>
        </div>
    </div>
    
    <!-- æ·»åŠ å­¦ç”Ÿæ¨¡æ€æ¡† -->
    <div id="addStudentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">æ·»åŠ å­¦ç”Ÿ</h3>
            <p class="mb-4 text-gray-600">è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼š</p>
            <input type="text" id="studentNameInput" class="w-full p-4 border border-gray-300 rounded-lg mb-4 text-lg" placeholder="å­¦ç”Ÿå§“å">
            <div class="mb-4">
                <label class="block text-gray-700 mb-2">é€‰æ‹©åˆ†ç»„ï¼š</label>
                <select id="studentGroupSelect" class="w-full p-3 border border-gray-300 rounded-lg text-lg">
                    <option value="0">æœªåˆ†ç»„</option>
                    <!-- åˆ†ç»„é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancelAddStudent" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å–æ¶ˆ</button>
                <button id="confirmAddStudent" class="px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition text-lg touch-button">ç¡®å®š</button>
            </div>
        </div>
    </div>
    
    <!-- æ‰¹é‡æ·»åŠ å­¦ç”Ÿæ¨¡æ€æ¡† -->
    <div id="batchAddStudentsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">æ‰¹é‡æ·»åŠ å­¦ç”Ÿ</h3>
            <p class="mb-4 text-gray-600">è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼Œæ¯è¡Œä¸€ä¸ªï¼š</p>
            <textarea id="batchStudentNames" class="w-full h-48 p-4 border border-gray-300 rounded-lg mb-4 text-lg" placeholder="ä¾‹å¦‚ï¼š
å¼ ä¸‰
æå››
ç‹äº”"></textarea>
            <div class="flex justify-between items-center mb-4">
                <div class="text-lg text-gray-500">å·²è¾“å…¥ <span id="studentCount">0</span> ä¸ªå­¦ç”Ÿ</div>
                <button id="clearBatchInput" class="text-lg text-red-500 hover:text-red-700 touch-button">æ¸…ç©ºè¾“å…¥</button>
            </div>
            <div class="flex justify-end gap-2">
                <button id="cancelBatchAddStudents" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å–æ¶ˆ</button>
                <button id="confirmBatchAddStudents" class="px-4 py-3 bg-teal-500 hover:bg-teal-600 text-white rounded-lg transition text-lg touch-button">ç¡®å®š</button>
            </div>
        </div>
    </div>
    
    <!-- æ’è¡Œæ¦œæ¨¡æ€æ¡† -->
    <div id="rankingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md max-h-[80vh] overflow-y-auto custom-scrollbar fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">ç§¯åˆ†æ’è¡Œæ¦œ</h3>
            <div id="rankingList" class="space-y-3">
                <!-- æ’è¡Œæ¦œå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="flex justify-end mt-4">
                <button id="closeRanking" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- ç­çº§ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="manageClassesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto custom-scrollbar fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">ç­çº§ç®¡ç†</h3>
            
            <!-- æ·»åŠ æ–°ç­çº§ -->
            <div class="mb-6 p-4 bg-blue-50 rounded-lg">
                <h4 class="text-lg font-semibold mb-2 text-blue-700">æ·»åŠ æ–°ç­çº§</h4>
                <div class="flex gap-2">
                    <input type="text" id="newClassName" class="flex-1 p-4 border border-gray-300 rounded-lg text-lg" placeholder="è¾“å…¥æ–°ç­çº§åç§°">
                    <button id="addNewClass" class="px-4 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition text-lg touch-button">æ·»åŠ </button>
                </div>
            </div>
            
            <!-- ç­çº§åˆ—è¡¨ -->
            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">ç°æœ‰ç­çº§</h4>
                <div id="classesList" class="space-y-3">
                    <!-- ç­çº§åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="flex justify-end mt-4">
                <button id="closeManageClasses" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- éšæœºç‚¹åæ¨¡æ€æ¡† -->
    <div id="randomCallModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md fade-in modal-container text-center">
            <h3 class="text-xl font-bold mb-4">éšæœºç‚¹å</h3>
            <div id="randomCallDisplay" class="text-4xl font-bold text-blue-600 my-8 min-h-[60px] flex items-center justify-center">
                <!-- è¿™é‡Œæ˜¾ç¤ºéšæœºé€‰ä¸­çš„å­¦ç”Ÿ -->
            </div>
            <div class="mb-4">
                <button id="startRandomCall" class="px-6 py-4 bg-pink-500 hover:bg-pink-600 text-white rounded-lg transition text-xl touch-button w-full">
                    <i class="fas fa-random mr-2"></i>å¼€å§‹éšæœºç‚¹å
                </button>
            </div>
            <div class="flex justify-center gap-2">
                <button id="closeRandomCall" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- åˆ†ç»„ç®¡ç†æ¨¡æ€æ¡† -->
    <div id="manageGroupsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto custom-scrollbar fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">åˆ†ç»„ç®¡ç†</h3>
            
            <!-- æ·»åŠ æ–°åˆ†ç»„ -->
            <div class="mb-6 p-4 bg-orange-50 rounded-lg">
                <h4 class="text-lg font-semibold mb-2 text-orange-700">æ·»åŠ æ–°åˆ†ç»„</h4>
                <div class="flex gap-2">
                    <input type="text" id="newGroupName" class="flex-1 p-4 border border-gray-300 rounded-lg text-lg" placeholder="è¾“å…¥æ–°åˆ†ç»„åç§°">
                    <button id="addNewGroup" class="px-4 py-3 bg-orange-500 hover:bg-orange-600 text-white rounded-lg transition text-lg touch-button">æ·»åŠ </button>
                </div>
            </div>
            
            <!-- è‡ªåŠ¨åˆ†ç»„ -->
            <div class="mb-6 p-4 bg-green-50 rounded-lg">
                <h4 class="text-lg font-semibold mb-2 text-green-700">è‡ªåŠ¨åˆ†ç»„</h4>
                <div class="flex gap-2 items-center">
                    <span class="text-gray-700">åˆ†æˆ</span>
                    <input type="number" id="groupCount" class="w-20 p-3 border border-gray-300 rounded-lg text-lg" min="2" max="10" value="4">
                    <span class="text-gray-700">ä¸ªå°ç»„</span>
                    <button id="autoGroup" class="px-4 py-3 bg-green-500 hover:bg-green-600 text-white rounded-lg transition text-lg touch-button ml-2">è‡ªåŠ¨åˆ†ç»„</button>
                </div>
            </div>
            
            <!-- åˆ†ç»„åˆ—è¡¨ -->
            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">ç°æœ‰åˆ†ç»„</h4>
                <div id="groupsList" class="space-y-3">
                    <!-- åˆ†ç»„åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <div class="flex justify-end mt-4">
                <button id="closeManageGroups" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- å†å²è®°å½•æ¨¡æ€æ¡† -->
    <div id="historyModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[80vh] overflow-y-auto custom-scrollbar fade-in modal-container">
            <h3 class="text-xl font-bold mb-4">æ‰£åˆ†å†å²è®°å½•</h3>
            <div class="mb-4">
                <label class="block text-gray-700 mb-2">ç­›é€‰å­¦ç”Ÿï¼š</label>
                <select id="historyStudentFilter" class="w-full p-3 border border-gray-300 rounded-lg text-lg">
                    <option value="all">æ‰€æœ‰å­¦ç”Ÿ</option>
                    <!-- å­¦ç”Ÿé€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </select>
            </div>
            <div id="historyList" class="space-y-3">
                <!-- å†å²è®°å½•å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="flex justify-end mt-4">
                <button id="closeHistory" class="px-4 py-3 bg-gray-300 hover:bg-gray-400 rounded-lg transition text-lg touch-button">å…³é—­</button>
            </div>
        </div>
    </div>
    
    <!-- æ–‡ä»¶å¯¼å…¥è¾“å…¥ï¼ˆéšè—ï¼‰ -->
    <input type="file" id="fileInput" accept=".txt" class="hidden">
    
    <script>
        // åˆå§‹åŒ–æ•°æ®
        let classes = JSON.parse(localStorage.getItem('classPointsClasses')) || {
            'ä¸‰å¹´ï¼ˆ4ï¼‰ç­': []
        };
        let currentClass = localStorage.getItem('classPointsCurrentClass') || 'ä¸‰å¹´ï¼ˆ4ï¼‰ç­';
        let groups = JSON.parse(localStorage.getItem('classPointsGroups')) || {
            'ä¸‰å¹´ï¼ˆ4ï¼‰ç­': [
                { id: 1, name: 'ç¬¬ä¸€ç»„', students: [] },
                { id: 2, name: 'ç¬¬äºŒç»„', students: [] },
                { id: 3, name: 'ç¬¬ä¸‰ç»„', students: [] },
                { id: 4, name: 'ç¬¬å››ç»„', students: [] }
            ]
        };
        
        // å†å²è®°å½•æ•°æ®ï¼ˆåªè®°å½•æ‰£åˆ†ï¼‰
        let history = JSON.parse(localStorage.getItem('classPointsHistory')) || {};
        
        // DOMå…ƒç´ 
        const studentGrid = document.getElementById('studentGrid');
        const groupView = document.getElementById('groupView');
        const groupsContainer = document.getElementById('groupsContainer');
        const classTitleElement = document.getElementById('classTitle');
        const classSelector = document.getElementById('classSelector');
        const messageElement = document.getElementById('message');
        const loadingScreen = document.getElementById('loadingScreen');
        const app = document.getElementById('app');
        
        // éšæœºç‚¹åç›¸å…³å˜é‡
        let randomCallInterval = null;
        let isRandomCallRunning = false;
        
        // å½“å‰æ“ä½œçš„å­¦ç”Ÿç´¢å¼•
        let currentStudentIndex = null;
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åº”ç”¨
        window.addEventListener('load', function() {
            // æ¨¡æ‹ŸåŠ è½½æ—¶é—´
            setTimeout(() => {
                loadingScreen.classList.add('hidden');
                app.classList.remove('hidden');
                initApp();
            }, 1000);
        });
        
        function initApp() {
            updateClassTitle();
            updateClassSelector();
            updateGroupSelectors();
            renderStudents();
            renderGroupsView();
            
            // è§†å›¾åˆ‡æ¢
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„activeç±»
                    document.querySelectorAll('.tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // æ·»åŠ å½“å‰æŒ‰é’®çš„activeç±»
                    this.classList.add('active');
                    
                    // åˆ‡æ¢è§†å›¾
                    const view = this.getAttribute('data-view');
                    if (view === 'all') {
                        studentGrid.classList.remove('hidden');
                        groupView.classList.add('hidden');
                    } else if (view === 'group') {
                        studentGrid.classList.add('hidden');
                        groupView.classList.remove('hidden');
                    }
                });
            });
            
            // ç­çº§é€‰æ‹©å™¨å˜åŒ–äº‹ä»¶
            classSelector.addEventListener('change', function() {
                currentClass = this.value;
                localStorage.setItem('classPointsCurrentClass', currentClass);
                updateClassTitle();
                updateGroupSelectors();
                renderStudents();
                renderGroupsView();
                showMessage(`å·²åˆ‡æ¢åˆ°ç­çº§: ${currentClass}`, 'success');
            });
            
            // ç®¡ç†ç­çº§æŒ‰é’®äº‹ä»¶
            document.getElementById('manageClasses').addEventListener('click', function() {
                renderClassesList();
                document.getElementById('manageClassesModal').classList.remove('hidden');
            });
            
            // æ·»åŠ æ–°ç­çº§æŒ‰é’®äº‹ä»¶
            document.getElementById('addNewClass').addEventListener('click', function() {
                const newClassName = document.getElementById('newClassName').value.trim();
                
                if (newClassName) {
                    if (classes[newClassName]) {
                        alert(`ç­çº§ "${newClassName}" å·²å­˜åœ¨ï¼`);
                        return;
                    }
                    
                    classes[newClassName] = [];
                    groups[newClassName] = [
                        { id: 1, name: 'ç¬¬ä¸€ç»„', students: [] },
                        { id: 2, name: 'ç¬¬äºŒç»„', students: [] },
                        { id: 3, name: 'ç¬¬ä¸‰ç»„', students: [] },
                        { id: 4, name: 'ç¬¬å››ç»„', students: [] }
                    ];
                    saveClasses();
                    saveGroups();
                    renderClassesList();
                    updateClassSelector();
                    document.getElementById('newClassName').value = '';
                    showMessage(`å·²æ·»åŠ æ–°ç­çº§: ${newClassName}`, 'success');
                } else {
                    alert('è¯·è¾“å…¥ç­çº§åç§°ï¼');
                }
            });
            
            // å…³é—­ç­çº§ç®¡ç†æ¨¡æ€æ¡†
            document.getElementById('closeManageClasses').addEventListener('click', function() {
                document.getElementById('manageClassesModal').classList.add('hidden');
            });
            
            // åˆ†ç»„ç®¡ç†æŒ‰é’®äº‹ä»¶
            document.getElementById('manageGroups').addEventListener('click', function() {
                renderGroupsList();
                document.getElementById('manageGroupsModal').classList.remove('hidden');
            });
            
            // æ·»åŠ æ–°åˆ†ç»„æŒ‰é’®äº‹ä»¶
            document.getElementById('addNewGroup').addEventListener('click', function() {
                const newGroupName = document.getElementById('newGroupName').value.trim();
                
                if (newGroupName) {
                    const currentGroups = getCurrentGroups();
                    const newGroupId = currentGroups.length > 0 ? 
                        Math.max(...currentGroups.map(g => g.id)) + 1 : 1;
                    
                    currentGroups.push({
                        id: newGroupId,
                        name: newGroupName,
                        students: []
                    });
                    
                    setCurrentGroups(currentGroups);
                    renderGroupsList();
                    updateGroupSelectors();
                    document.getElementById('newGroupName').value = '';
                    showMessage(`å·²æ·»åŠ æ–°åˆ†ç»„: ${newGroupName}`, 'success');
                } else {
                    alert('è¯·è¾“å…¥åˆ†ç»„åç§°ï¼');
                }
            });
            
            // è‡ªåŠ¨åˆ†ç»„æŒ‰é’®äº‹ä»¶
            document.getElementById('autoGroup').addEventListener('click', function() {
                autoGroupStudents();
            });
            
            // å…³é—­åˆ†ç»„ç®¡ç†æ¨¡æ€æ¡†
            document.getElementById('closeManageGroups').addEventListener('click', function() {
                document.getElementById('manageGroupsModal').classList.add('hidden');
            });
            
            // å…¨ç­åŠ åˆ†æŒ‰é’®äº‹ä»¶
            document.getElementById('addAllPoints').addEventListener('click', function() {
                document.getElementById('addAllPointsModal').classList.remove('hidden');
                document.getElementById('pointsInput').value = 1;
                document.getElementById('pointsInput').focus();
            });
            
            // å…¨ç­åŠ åˆ†ç¡®è®¤æŒ‰é’®äº‹ä»¶
            document.getElementById('confirmAddAllPoints').addEventListener('click', function() {
                const points = parseInt(document.getElementById('pointsInput').value);
                const students = getCurrentStudents();
                
                if (!isNaN(points) && points > 0) {
                    students.forEach(student => {
                        student.points += points;
                    });
                    
                    setCurrentStudents(students);
                    renderStudents();
                    renderGroupsView();
                    document.getElementById('addAllPointsModal').classList.add('hidden');
                    showMessage(`å·²å¢åŠ å…¨ç­ç§¯åˆ† ${points} åˆ†`, 'success');
                } else {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„æ­£æ•°ï¼');
                }
            });
            
            // å…¨ç­åŠ åˆ†å–æ¶ˆæŒ‰é’®äº‹ä»¶
            document.getElementById('cancelAddAllPoints').addEventListener('click', function() {
                document.getElementById('addAllPointsModal').classList.add('hidden');
            });
            
            // å…¨ç­æ¸…é›¶æŒ‰é’®äº‹ä»¶
            document.getElementById('resetAllPoints').addEventListener('click', function() {
                if (confirm('ç¡®å®šè¦å°†å…¨ç­ç§¯åˆ†æ¸…é›¶å—ï¼Ÿ')) {
                    const students = getCurrentStudents();
                    students.forEach(student => {
                        student.points = 0;
                    });
                    
                    setCurrentStudents(students);
                    renderStudents();
                    renderGroupsView();
                    showMessage('å…¨ç­ç§¯åˆ†å·²æ¸…é›¶', 'success');
                }
            });
            
            // æ’è¡Œæ¦œæŒ‰é’®äº‹ä»¶
            document.getElementById('showRanking').addEventListener('click', function() {
                const rankingList = document.getElementById('rankingList');
                rankingList.innerHTML = '';
                
                const students = getCurrentStudents();
                // åˆ›å»ºå­¦ç”Ÿå‰¯æœ¬å¹¶æ’åº
                const sortedStudents = [...students].sort((a, b) => b.points - a.points);
                
                if (sortedStudents.length === 0) {
                    rankingList.innerHTML = '<p class="text-center text-gray-500 py-4 text-lg">æš‚æ— å­¦ç”Ÿæ•°æ®</p>';
                } else {
                    sortedStudents.forEach((student, index) => {
                        const rankItem = document.createElement('div');
                        rankItem.className = 'flex items-center justify-between p-4 bg-gray-50 rounded-lg';
                        
                        let medal = '';
                        if (index === 0) medal = 'ğŸ¥‡';
                        else if (index === 1) medal = 'ğŸ¥ˆ';
                        else if (index === 2) medal = 'ğŸ¥‰';
                        
                        rankItem.innerHTML = `
                            <div class="flex items-center">
                                <span class="text-2xl mr-3">${medal}</span>
                                <span class="font-medium text-lg">${student.name}</span>
                            </div>
                            <span class="font-bold text-lg ${student.points >= 0 ? 'text-red-600' : 'text-red-400'}">${student.points} åˆ†</span>
                        `;
                        rankingList.appendChild(rankItem);
                    });
                }
                
                document.getElementById('rankingModal').classList.remove('hidden');
            });
            
            // å…³é—­æ’è¡Œæ¦œæŒ‰é’®äº‹ä»¶
            document.getElementById('closeRanking').addEventListener('click', function() {
                document.getElementById('rankingModal').classList.add('hidden');
            });
            
            // å¯¼å…¥ç§¯åˆ†æŒ‰é’®äº‹ä»¶
            document.getElementById('importPoints').addEventListener('click', function() {
                document.getElementById('fileInput').click();
            });
            
            // æ–‡ä»¶è¾“å…¥å˜åŒ–äº‹ä»¶
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const content = event.target.result;
                    const lines = content.split('\n');
                    const newStudents = [];
                    
                    lines.forEach(line => {
                        if (line.trim()) {
                            const parts = line.split('ï¼Œ');
                            if (parts.length === 2) {
                                const name = parts[0].trim();
                                const points = parseInt(parts[1].trim());
                                
                                if (name && !isNaN(points)) {
                                    newStudents.push({ name, points, groupId: 0 });
                                }
                            }
                        }
                    });
                    
                    if (newStudents.length > 0) {
                        setCurrentStudents(newStudents);
                        renderStudents();
                        renderGroupsView();
                        showMessage(`æˆåŠŸå¯¼å…¥ ${newStudents.length} åå­¦ç”Ÿæ•°æ®`, 'success');
                    } else {
                        alert('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼è¯·ç¡®ä¿æ–‡ä»¶å†…å®¹æ ¼å¼ä¸ºï¼š"å­¦ç”Ÿå§“åï¼Œç§¯åˆ†"ï¼Œæ¯è¡Œä¸€ä¸ªå­¦ç”Ÿã€‚');
                    }
                    
                    // é‡ç½®æ–‡ä»¶è¾“å…¥
                    document.getElementById('fileInput').value = '';
                };
                
                reader.readAsText(file);
            });
            
            // å¯¼å‡ºç§¯åˆ†æŒ‰é’®äº‹ä»¶
            document.getElementById('exportPoints').addEventListener('click', function() {
                const students = getCurrentStudents();
                if (students.length === 0) {
                    alert('æ²¡æœ‰å­¦ç”Ÿæ•°æ®å¯ä»¥å¯¼å‡ºï¼');
                    return;
                }
                
                let content = '';
                students.forEach(student => {
                    content += `${student.name}ï¼Œ${student.points}\n`;
                });
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentClass}ç§¯åˆ†æ•°æ®.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showMessage('ç§¯åˆ†æ•°æ®å·²å¯¼å‡º', 'success');
            });
            
            // æ·»åŠ å­¦ç”ŸæŒ‰é’®äº‹ä»¶
            document.getElementById('addStudent').addEventListener('click', function() {
                document.getElementById('addStudentModal').classList.remove('hidden');
                document.getElementById('studentNameInput').value = '';
                document.getElementById('studentGroupSelect').value = '0';
                document.getElementById('studentNameInput').focus();
            });
            
            // æ·»åŠ å­¦ç”Ÿç¡®è®¤æŒ‰é’®äº‹ä»¶
            document.getElementById('confirmAddStudent').addEventListener('click', function() {
                const name = document.getElementById('studentNameInput').value.trim();
                const groupId = parseInt(document.getElementById('studentGroupSelect').value);
                const students = getCurrentStudents();
                
                if (name) {
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå­¦ç”Ÿ
                    const exists = students.some(student => student.name === name);
                    if (exists) {
                        alert(`å­¦ç”Ÿ "${name}" å·²å­˜åœ¨ï¼`);
                        return;
                    }
                    
                    students.unshift({ name, points: 0, groupId });
                    setCurrentStudents(students);
                    renderStudents();
                    renderGroupsView();
                    document.getElementById('addStudentModal').classList.add('hidden');
                    showMessage(`å·²æ·»åŠ å­¦ç”Ÿ "${name}"`, 'success');
                } else {
                    alert('è¯·è¾“å…¥å­¦ç”Ÿå§“åï¼');
                }
            });
            
            // æ·»åŠ å­¦ç”Ÿå–æ¶ˆæŒ‰é’®äº‹ä»¶
            document.getElementById('cancelAddStudent').addEventListener('click', function() {
                document.getElementById('addStudentModal').classList.add('hidden');
            });
            
            // æ‰¹é‡æ·»åŠ å­¦ç”ŸæŒ‰é’®äº‹ä»¶
            document.getElementById('batchAddStudents').addEventListener('click', function() {
                document.getElementById('batchAddStudentsModal').classList.remove('hidden');
                document.getElementById('batchStudentNames').value = '';
                document.getElementById('studentCount').textContent = '0';
                document.getElementById('batchStudentNames').focus();
            });
            
            // æ‰¹é‡æ·»åŠ å­¦ç”Ÿè¾“å…¥å˜åŒ–äº‹ä»¶
            document.getElementById('batchStudentNames').addEventListener('input', function() {
                const names = this.value.split('\n').filter(name => name.trim() !== '');
                document.getElementById('studentCount').textContent = names.length;
            });
            
            // æ¸…ç©ºæ‰¹é‡è¾“å…¥æŒ‰é’®äº‹ä»¶
            document.getElementById('clearBatchInput').addEventListener('click', function() {
                document.getElementById('batchStudentNames').value = '';
                document.getElementById('studentCount').textContent = '0';
            });
            
            // æ‰¹é‡æ·»åŠ å­¦ç”Ÿç¡®è®¤æŒ‰é’®äº‹ä»¶
            document.getElementById('confirmBatchAddStudents').addEventListener('click', function() {
                const namesText = document.getElementById('batchStudentNames').value;
                const names = namesText.split('\n')
                    .map(name => name.trim())
                    .filter(name => name !== '');
                const students = getCurrentStudents();
                
                if (names.length === 0) {
                    alert('è¯·è¾“å…¥è‡³å°‘ä¸€ä¸ªå­¦ç”Ÿå§“åï¼');
                    return;
                }
                
                let addedCount = 0;
                let skippedCount = 0;
                
                names.forEach(name => {
                    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåå­¦ç”Ÿ
                    const exists = students.some(student => student.name === name);
                    if (!exists) {
                        students.unshift({ name, points: 0, groupId: 0 });
                        addedCount++;
                    } else {
                        skippedCount++;
                    }
                });
                
                setCurrentStudents(students);
                renderStudents();
                renderGroupsView();
                document.getElementById('batchAddStudentsModal').classList.add('hidden');
                
                let message = `å·²æˆåŠŸæ·»åŠ  ${addedCount} åå­¦ç”Ÿ`;
                if (skippedCount > 0) {
                    message += `ï¼Œè·³è¿‡ ${skippedCount} åå·²å­˜åœ¨å­¦ç”Ÿ`;
                }
                showMessage(message, 'success');
            });
            
            // æ‰¹é‡æ·»åŠ å­¦ç”Ÿå–æ¶ˆæŒ‰é’®äº‹ä»¶
            document.getElementById('cancelBatchAddStudents').addEventListener('click', function() {
                document.getElementById('batchAddStudentsModal').classList.add('hidden');
            });
            
            // éšæœºç‚¹åæŒ‰é’®äº‹ä»¶
            document.getElementById('randomCall').addEventListener('click', function() {
                document.getElementById('randomCallModal').classList.remove('hidden');
                // é‡ç½®éšæœºç‚¹åçŠ¶æ€
                isRandomCallRunning = false;
                document.getElementById('startRandomCall').innerHTML = '<i class="fas fa-random mr-2"></i>å¼€å§‹éšæœºç‚¹å';
                document.getElementById('startRandomCall').classList.remove('bg-red-500', 'hover:bg-red-600');
                document.getElementById('startRandomCall').classList.add('bg-pink-500', 'hover:bg-pink-600');
                document.getElementById('randomCallDisplay').classList.remove('random-call-animation', 'bounce');
                document.getElementById('randomCallDisplay').textContent = 'ç­‰å¾…ç‚¹å...';
                
                // æ¸…é™¤ä¹‹å‰çš„é«˜äº®
                const studentCards = document.querySelectorAll('.student-card');
                studentCards.forEach(card => {
                    card.classList.remove('selected-student');
                });
            });
            
            // å¼€å§‹éšæœºç‚¹åæŒ‰é’®äº‹ä»¶
            document.getElementById('startRandomCall').addEventListener('click', function() {
                startRandomCall();
            });
            
            // å…³é—­éšæœºç‚¹åæ¨¡æ€æ¡†
            document.getElementById('closeRandomCall').addEventListener('click', function() {
                document.getElementById('randomCallModal').classList.add('hidden');
                // åœæ­¢éšæœºç‚¹å
                if (isRandomCallRunning) {
                    isRandomCallRunning = false;
                    clearInterval(randomCallInterval);
                }
            });
            
            // å†å²è®°å½•æŒ‰é’®äº‹ä»¶
            document.getElementById('showHistory').addEventListener('click', function() {
                renderHistoryList();
                document.getElementById('historyModal').classList.remove('hidden');
            });
            
            // å†å²è®°å½•ç­›é€‰å˜åŒ–äº‹ä»¶
            document.getElementById('historyStudentFilter').addEventListener('change', function() {
                renderHistoryList();
            });
            
            // å…³é—­å†å²è®°å½•æ¨¡æ€æ¡†
            document.getElementById('closeHistory').addEventListener('click', function() {
                document.getElementById('historyModal').classList.add('hidden');
            });
            
            // å¿«é€Ÿé€‰æ‹©åŸå› æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.quick-reason').forEach(button => {
                button.addEventListener('click', function() {
                    const reason = this.getAttribute('data-reason');
                    document.getElementById('deductReason').value = reason;
                });
            });
            
            // ç¡®è®¤æ‰£åˆ†æŒ‰é’®äº‹ä»¶
            document.getElementById('confirmDeductPoints').addEventListener('click', function() {
                const students = getCurrentStudents();
                const reason = document.getElementById('deductReason').value.trim();
                
                if (reason === '') {
                    alert('è¯·è¾“å…¥æ‰£åˆ†åŸå› ï¼');
                    return;
                }
                
                students[currentStudentIndex].points -= 1;
                
                // è®°å½•å†å²ï¼ˆåªè®°å½•æ‰£åˆ†ï¼‰
                addHistoryRecord(students[currentStudentIndex].name, -1, reason);
                
                setCurrentStudents(students);
                renderStudents();
                renderGroupsView();
                document.getElementById('deductPointsModal').classList.add('hidden');
                showMessage(`å·²æ‰£é™¤ ${students[currentStudentIndex].name} 1åˆ†`, 'success');
            });
            
            // å–æ¶ˆæ‰£åˆ†æŒ‰é’®äº‹ä»¶
            document.getElementById('cancelDeductPoints').addEventListener('click', function() {
                document.getElementById('deductPointsModal').classList.add('hidden');
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­æ¨¡æ€æ¡†
            document.querySelectorAll('.fixed.inset-0').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.add('hidden');
                    }
                });
            });
            
            // Safariè§¦æ‘¸äº‹ä»¶ä¼˜åŒ–
            document.addEventListener('touchstart', function() {}, {passive: true});
        }
        
        // è·å–å½“å‰ç­çº§çš„å­¦ç”Ÿæ•°æ®
        function getCurrentStudents() {
            return classes[currentClass] || [];
        }
        
        // è®¾ç½®å½“å‰ç­çº§çš„å­¦ç”Ÿæ•°æ®
        function setCurrentStudents(students) {
            classes[currentClass] = students;
            saveClasses();
        }
        
        // è·å–å½“å‰ç­çº§çš„åˆ†ç»„æ•°æ®
        function getCurrentGroups() {
            return groups[currentClass] || [];
        }
        
        // è®¾ç½®å½“å‰ç­çº§çš„åˆ†ç»„æ•°æ®
        function setCurrentGroups(groupData) {
            groups[currentClass] = groupData;
            saveGroups();
        }
        
        // æ›´æ–°ç­çº§æ ‡é¢˜
        function updateClassTitle() {
            classTitleElement.innerHTML = `${currentClass}ç§¯åˆ†ç³»ç»Ÿ <span class="ml-2 text-yellow-500">âœ¨</span>`;
        }
        
        // æ›´æ–°ç­çº§é€‰æ‹©å™¨
        function updateClassSelector() {
            classSelector.innerHTML = '';
            Object.keys(classes).forEach(className => {
                const option = document.createElement('option');
                option.value = className;
                option.textContent = className;
                if (className === currentClass) {
                    option.selected = true;
                }
                classSelector.appendChild(option);
            });
        }
        
        // æ›´æ–°åˆ†ç»„é€‰æ‹©å™¨
        function updateGroupSelectors() {
            const groupSelect = document.getElementById('studentGroupSelect');
            groupSelect.innerHTML = '<option value="0">æœªåˆ†ç»„</option>';
            
            const currentGroups = getCurrentGroups();
            currentGroups.forEach(group => {
                const option = document.createElement('option');
                option.value = group.id;
                option.textContent = group.name;
                groupSelect.appendChild(option);
            });
        }
        
        // æ›´æ–°å†å²è®°å½•å­¦ç”Ÿç­›é€‰å™¨
        function updateHistoryStudentFilter() {
            const filterSelect = document.getElementById('historyStudentFilter');
            filterSelect.innerHTML = '<option value="all">æ‰€æœ‰å­¦ç”Ÿ</option>';
            
            const students = getCurrentStudents();
            students.forEach(student => {
                const option = document.createElement('option');
                option.value = student.name;
                option.textContent = student.name;
                filterSelect.appendChild(option);
            });
        }
        
        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'info') {
            messageElement.textContent = text;
            messageElement.className = `fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 fade-in ${type === 'success' ? 'bg-green-500 text-white' : type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'}`;
            messageElement.classList.remove('hidden');
            
            setTimeout(() => {
                messageElement.classList.add('hidden');
            }, 3000);
        }
        
        // æ¸²æŸ“å­¦ç”Ÿå¡ç‰‡
        function renderStudents() {
            const students = getCurrentStudents();
            studentGrid.innerHTML = '';
            
            if (students.length === 0) {
                studentGrid.innerHTML = `
                    <div class="col-span-full text-center py-12 bg-white rounded-xl shadow-sm">
                        <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                        <p class="text-xl text-gray-500">æš‚æ— å­¦ç”Ÿæ•°æ®</p>
                        <p class="text-gray-400 mt-2">ç‚¹å‡»"æ·»åŠ å­¦ç”Ÿ"æˆ–"æ‰¹é‡æ·»åŠ "æŒ‰é’®æ·»åŠ å­¦ç”Ÿ</p>
                    </div>
                `;
                return;
            }
            
            students.forEach((student, index) => {
                const studentCard = document.createElement('div');
                studentCard.className = `student-card bg-white rounded-xl shadow-md p-4 flex flex-col items-center group-${student.groupId || 0}`;
                studentCard.innerHTML = `
                    <div class="flex justify-between w-full mb-2">
                        <button class="text-red-500 hover:text-red-700 delete-student touch-button" data-index="${index}" title="åˆ é™¤å­¦ç”Ÿ">
                            <i class="fas fa-trash text-lg"></i>
                        </button>
                        <span class="text-gray-500">#${index + 1}</span>
                    </div>
                    <div class="text-xl font-bold text-black mb-2 text-center">${student.name}</div>
                    <div class="text-2xl font-bold ${student.points >= 0 ? 'text-red-600' : 'text-red-400'} mb-4">${student.points}</div>
                    <div class="flex justify-between w-full">
                        <button class="bg-red-500 hover:bg-red-600 text-white w-14 h-14 rounded-full flex items-center justify-center text-xl deduct-btn touch-button" data-index="${index}" title="æ‰£åˆ†">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button class="bg-green-500 hover:bg-green-600 text-white w-14 h-14 rounded-full flex items-center justify-center text-xl add-btn touch-button" data-index="${index}" title="åŠ åˆ†">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                `;
                studentGrid.appendChild(studentCard);
            });
            
            // æ·»åŠ æ‰£åˆ†æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.deduct-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    currentStudentIndex = index;
                    
                    document.getElementById('deductPointsModal').classList.remove('hidden');
                    document.getElementById('deductReason').value = '';
                });
            });
            
            // æ·»åŠ åŠ åˆ†æŒ‰é’®äº‹ä»¶ç›‘å¬ï¼ˆç›´æ¥åŠ åˆ†ï¼Œä¸è®°å½•åŸå› ï¼‰
            document.querySelectorAll('.add-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const students = getCurrentStudents();
                    
                    students[index].points += 1;
                    
                    setCurrentStudents(students);
                    renderStudents();
                    renderGroupsView();
                    showMessage(`å·²å¢åŠ  ${students[index].name} 1åˆ†`, 'success');
                });
            });
            
            // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.delete-student').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const students = getCurrentStudents();
                    const studentName = students[index].name;
                    
                    if (confirm(`ç¡®å®šè¦åˆ é™¤å­¦ç”Ÿ "${studentName}" å—ï¼Ÿ`)) {
                        students.splice(index, 1);
                        setCurrentStudents(students);
                        renderStudents();
                        renderGroupsView();
                        showMessage(`å·²åˆ é™¤å­¦ç”Ÿ "${studentName}"`, 'success');
                    }
                });
            });
        }
        
        // æ¸²æŸ“åˆ†ç»„è§†å›¾
        function renderGroupsView() {
            const currentGroups = getCurrentGroups();
            const students = getCurrentStudents();
            
            groupsContainer.innerHTML = '';
            
            if (currentGroups.length === 0) {
                groupsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12 bg-white rounded-xl shadow-sm">
                        <i class="fas fa-object-group text-6xl text-gray-300 mb-4"></i>
                        <p class="text-xl text-gray-500">æš‚æ— åˆ†ç»„æ•°æ®</p>
                        <p class="text-gray-400 mt-2">ç‚¹å‡»"åˆ†ç»„ç®¡ç†"æŒ‰é’®åˆ›å»ºåˆ†ç»„</p>
                    </div>
                `;
                return;
            }
            
            currentGroups.forEach(group => {
                const groupStudents = students.filter(student => student.groupId === group.id);
                const groupPoints = groupStudents.reduce((total, student) => total + student.points, 0);
                
                const groupCard = document.createElement('div');
                groupCard.className = `group-card bg-white rounded-xl shadow-md p-4 group-${group.id}`;
                groupCard.innerHTML = `
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-xl font-bold">${group.name}</h3>
                        <div class="flex gap-2">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm group-add-points touch-button" data-group="${group.id}">
                                <i class="fas fa-plus"></i>
                            </button>
                            <button class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm group-remove-points touch-button" data-group="${group.id}">
                                <i class="fas fa-minus"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-2xl font-bold text-center mb-4 ${groupPoints >= 0 ? 'text-red-600' : 'text-red-400'}">${groupPoints} åˆ†</div>
                    <div class="space-y-2">
                        ${groupStudents.length > 0 ? 
                            groupStudents.map(student => `
                                <div class="flex justify-between items-center p-2 bg-gray-50 rounded">
                                    <span>${student.name}</span>
                                    <span class="font-bold ${student.points >= 0 ? 'text-red-600' : 'text-red-400'}">${student.points}</span>
                                </div>
                            `).join('') : 
                            '<p class="text-center text-gray-500 py-2">æš‚æ— å­¦ç”Ÿ</p>'
                        }
                    </div>
                `;
                groupsContainer.appendChild(groupCard);
            });
            
            // æ·»åŠ å°ç»„åŠ åˆ†æŒ‰é’®äº‹ä»¶ï¼ˆç›´æ¥åŠ åˆ†ï¼Œä¸è®°å½•åŸå› ï¼‰
            document.querySelectorAll('.group-add-points').forEach(button => {
                button.addEventListener('click', function() {
                    const groupId = parseInt(this.getAttribute('data-group'));
                    const students = getCurrentStudents();
                    
                    students.forEach(student => {
                        if (student.groupId === groupId) {
                            student.points += 1;
                        }
                    });
                    
                    setCurrentStudents(students);
                    renderStudents();
                    renderGroupsView();
                    showMessage(`å·²ä¸ºå°ç»„å¢åŠ ç§¯åˆ†`, 'success');
                });
            });
            
            // æ·»åŠ å°ç»„æ‰£åˆ†æŒ‰é’®äº‹ä»¶ï¼ˆéœ€è¦è®°å½•åŸå› ï¼‰
            document.querySelectorAll('.group-remove-points').forEach(button => {
                button.addEventListener('click', function() {
                    const groupId = parseInt(this.getAttribute('data-group'));
                    const students = getCurrentStudents();
                    
                    // è·å–å°ç»„å­¦ç”Ÿå§“å
                    const groupStudents = students.filter(student => student.groupId === groupId);
                    const studentNames = groupStudents.map(student => student.name).join('ã€');
                    
                    if (confirm(`ç¡®å®šè¦ä¸ºå°ç»„ "${studentNames}" æ‰£åˆ†å—ï¼Ÿ`)) {
                        // å¼¹å‡ºæ‰£åˆ†åŸå› æ¨¡æ€æ¡†
                        document.getElementById('deductPointsModal').classList.remove('hidden');
                        document.getElementById('deductReason').value = '';
                        
                        // è®¾ç½®å½“å‰æ“ä½œä¸ºå°ç»„æ‰£åˆ†
                        currentStudentIndex = null;
                        currentGroupId = groupId;
                    }
                });
            });
        }
        
        // æ¸²æŸ“ç­çº§åˆ—è¡¨
        function renderClassesList() {
            const classesList = document.getElementById('classesList');
            classesList.innerHTML = '';
            
            Object.keys(classes).forEach(className => {
                const classItem = document.createElement('div');
                classItem.className = 'class-card bg-white rounded-lg p-4 flex justify-between items-center';
                classItem.innerHTML = `
                    <div>
                        <span class="font-medium text-lg">${className}</span>
                        <span class="text-gray-500 ml-2">(${classes[className].length} åå­¦ç”Ÿ)</span>
                    </div>
                    <div class="flex gap-2">
                        <button class="switch-class px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded text-lg touch-button" data-class="${className}">åˆ‡æ¢</button>
                        ${className !== currentClass ? `<button class="delete-class px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded text-lg touch-button" data-class="${className}">åˆ é™¤</button>` : ''}
                    </div>
                `;
                classesList.appendChild(classItem);
            });
            
            // æ·»åŠ åˆ‡æ¢ç­çº§æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.switch-class').forEach(button => {
                button.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    currentClass = className;
                    localStorage.setItem('classPointsCurrentClass', currentClass);
                    updateClassTitle();
                    updateClassSelector();
                    renderStudents();
                    renderGroupsView();
                    document.getElementById('manageClassesModal').classList.add('hidden');
                    showMessage(`å·²åˆ‡æ¢åˆ°ç­çº§: ${className}`, 'success');
                });
            });
            
            // æ·»åŠ åˆ é™¤ç­çº§æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.delete-class').forEach(button => {
                button.addEventListener('click', function() {
                    const className = this.getAttribute('data-class');
                    
                    if (confirm(`ç¡®å®šè¦åˆ é™¤ç­çº§ "${className}" å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼`)) {
                        delete classes[className];
                        delete groups[className];
                        saveClasses();
                        saveGroups();
                        renderClassesList();
                        updateClassSelector();
                        
                        // å¦‚æœåˆ é™¤çš„æ˜¯å½“å‰ç­çº§ï¼Œåˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªç­çº§
                        if (currentClass === className) {
                            const classNames = Object.keys(classes);
                            if (classNames.length > 0) {
                                currentClass = classNames[0];
                                localStorage.setItem('classPointsCurrentClass', currentClass);
                                updateClassTitle();
                                updateClassSelector();
                                renderStudents();
                                renderGroupsView();
                            } else {
                                // å¦‚æœæ²¡æœ‰ç­çº§äº†ï¼Œåˆ›å»ºä¸€ä¸ªé»˜è®¤ç­çº§
                                classes = { 'é»˜è®¤ç­çº§': [] };
                                groups = { 'é»˜è®¤ç­çº§': [] };
                                currentClass = 'é»˜è®¤ç­çº§';
                                saveClasses();
                                saveGroups();
                                localStorage.setItem('classPointsCurrentClass', currentClass);
                                updateClassTitle();
                                updateClassSelector();
                                renderStudents();
                                renderGroupsView();
                            }
                        }
                        
                        showMessage(`å·²åˆ é™¤ç­çº§: ${className}`, 'success');
                    }
                });
            });
        }
        
        // æ¸²æŸ“åˆ†ç»„åˆ—è¡¨
        function renderGroupsList() {
            const groupsList = document.getElementById('groupsList');
            groupsList.innerHTML = '';
            
            const currentGroups = getCurrentGroups();
            
            if (currentGroups.length === 0) {
                groupsList.innerHTML = '<p class="text-center text-gray-500 py-4">æš‚æ— åˆ†ç»„</p>';
                return;
            }
            
            currentGroups.forEach((group, index) => {
                const students = getCurrentStudents();
                const groupStudents = students.filter(student => student.groupId === group.id);
                
                const groupItem = document.createElement('div');
                groupItem.className = 'group-card bg-white rounded-lg p-4 flex justify-between items-center';
                groupItem.innerHTML = `
                    <div>
                        <span class="font-medium text-lg">${group.name}</span>
                        <span class="text-gray-500 ml-2">(${groupStudents.length} åå­¦ç”Ÿ)</span>
                    </div>
                    <div class="flex gap-2">
                        <button class="delete-group px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded text-lg touch-button" data-index="${index}">åˆ é™¤</button>
                    </div>
                `;
                groupsList.appendChild(groupItem);
            });
            
            // æ·»åŠ åˆ é™¤åˆ†ç»„æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.delete-group').forEach(button => {
                button.addEventListener('click', function() {
                    const index = parseInt(this.getAttribute('data-index'));
                    const currentGroups = getCurrentGroups();
                    const groupName = currentGroups[index].name;
                    
                    if (confirm(`ç¡®å®šè¦åˆ é™¤åˆ†ç»„ "${groupName}" å—ï¼Ÿæ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼`)) {
                        // å°†åˆ†ç»„ä¸­çš„å­¦ç”Ÿè®¾ä¸ºæœªåˆ†ç»„
                        const students = getCurrentStudents();
                        students.forEach(student => {
                            if (student.groupId === currentGroups[index].id) {
                                student.groupId = 0;
                            }
                        });
                        setCurrentStudents(students);
                        
                        // åˆ é™¤åˆ†ç»„
                        currentGroups.splice(index, 1);
                        setCurrentGroups(currentGroups);
                        
                        renderGroupsList();
                        renderStudents();
                        renderGroupsView();
                        updateGroupSelectors();
                        
                        showMessage(`å·²åˆ é™¤åˆ†ç»„: ${groupName}`, 'success');
                    }
                });
            });
        }
        
        // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
        function renderHistoryList() {
            updateHistoryStudentFilter();
            
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            
            const studentFilter = document.getElementById('historyStudentFilter').value;
            let classHistory = history[currentClass] || [];
            
            // å¦‚æœç­›é€‰ç‰¹å®šå­¦ç”Ÿï¼Œåªæ˜¾ç¤ºè¯¥å­¦ç”Ÿçš„è®°å½•
            if (studentFilter !== 'all') {
                classHistory = classHistory.filter(record => record.student === studentFilter);
            }
            
            if (classHistory.length === 0) {
                historyList.innerHTML = '<p class="text-center text-gray-500 py-8">æš‚æ— æ‰£åˆ†è®°å½•</p>';
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—ï¼ˆæœ€æ–°çš„åœ¨å‰é¢ï¼‰
            classHistory.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            classHistory.forEach(record => {
                const historyItem = document.createElement('div');
                historyItem.className = `history-item bg-white rounded-lg p-4`;
                historyItem.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <span class="font-bold text-lg">${record.student}</span>
                            <span class="ml-2 font-bold text-red-600">-1åˆ†</span>
                        </div>
                        <span class="text-gray-500 text-sm">${formatDate(record.timestamp)}</span>
                    </div>
                    <div class="text-gray-700">${record.reason}</div>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // è‡ªåŠ¨åˆ†ç»„åŠŸèƒ½
        function autoGroupStudents() {
            const groupCount = parseInt(document.getElementById('groupCount').value) || 4;
            const students = getCurrentStudents();
            const currentGroups = getCurrentGroups();
            
            if (students.length === 0) {
                alert('å½“å‰ç­çº§æ²¡æœ‰å­¦ç”Ÿï¼Œæ— æ³•è¿›è¡Œè‡ªåŠ¨åˆ†ç»„ï¼');
                return;
            }
            
            // æ¸…ç©ºç°æœ‰åˆ†ç»„
            currentGroups.forEach(group => {
                group.students = [];
            });
            
            // å¦‚æœåˆ†ç»„æ•°é‡ä¸å¤Ÿï¼Œåˆ›å»ºæ–°çš„åˆ†ç»„
            while (currentGroups.length < groupCount) {
                const newGroupId = currentGroups.length + 1;
                currentGroups.push({
                    id: newGroupId,
                    name: `ç¬¬${newGroupId}ç»„`,
                    students: []
                });
            }
            
            // å¦‚æœåˆ†ç»„æ•°é‡è¿‡å¤šï¼Œåˆ é™¤å¤šä½™åˆ†ç»„
            if (currentGroups.length > groupCount) {
                currentGroups.splice(groupCount);
            }
            
            // éšæœºåˆ†é…å­¦ç”Ÿåˆ°å„ç»„
            const shuffledStudents = [...students].sort(() => Math.random() - 0.5);
            
            shuffledStudents.forEach((student, index) => {
                const groupIndex = index % groupCount;
                student.groupId = currentGroups[groupIndex].id;
            });
            
            setCurrentStudents(students);
            setCurrentGroups(currentGroups);
            
            renderStudents();
            renderGroupsView();
            renderGroupsList();
            updateGroupSelectors();
            
            showMessage(`å·²è‡ªåŠ¨å°†å­¦ç”Ÿåˆ†æˆ ${groupCount} ä¸ªå°ç»„`, 'success');
        }
        
        // ä¿å­˜ç­çº§æ•°æ®åˆ°localStorage
        function saveClasses() {
            localStorage.setItem('classPointsClasses', JSON.stringify(classes));
        }
        
        // ä¿å­˜åˆ†ç»„æ•°æ®åˆ°localStorage
        function saveGroups() {
            localStorage.setItem('classPointsGroups', JSON.stringify(groups));
        }
        
        // ä¿å­˜å†å²è®°å½•æ•°æ®åˆ°localStorage
        function saveHistory() {
            localStorage.setItem('classPointsHistory', JSON.stringify(history));
        }
        
        // æ·»åŠ å†å²è®°å½•ï¼ˆåªè®°å½•æ‰£åˆ†ï¼‰
        function addHistoryRecord(student, points, reason) {
            if (!history[currentClass]) {
                history[currentClass] = [];
            }
            
            history[currentClass].push({
                student,
                points,
                reason,
                timestamp: new Date().toISOString()
            });
            
            saveHistory();
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸæ˜¾ç¤º
        function formatDate(dateString) {
            const date = new Date(dateString);
            return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
        }
        
        // éšæœºç‚¹ååŠŸèƒ½
        function startRandomCall() {
            const students = getCurrentStudents();
            if (students.length === 0) {
                alert('å½“å‰ç­çº§æ²¡æœ‰å­¦ç”Ÿï¼Œæ— æ³•è¿›è¡Œéšæœºç‚¹åï¼');
                return;
            }
            
            const displayElement = document.getElementById('randomCallDisplay');
            const startButton = document.getElementById('startRandomCall');
            
            if (!isRandomCallRunning) {
                // å¼€å§‹éšæœºç‚¹å
                isRandomCallRunning = true;
                startButton.innerHTML = '<i class="fas fa-stop mr-2"></i>åœæ­¢ç‚¹å';
                startButton.classList.remove('bg-pink-500', 'hover:bg-pink-600');
                startButton.classList.add('bg-red-500', 'hover:bg-red-600');
                
                displayElement.classList.add('random-call-animation');
                
                randomCallInterval = setInterval(() => {
                    const randomIndex = Math.floor(Math.random() * students.length);
                    displayElement.textContent = students[randomIndex].name;
                }, 100);
            } else {
                // åœæ­¢éšæœºç‚¹å
                isRandomCallRunning = false;
                startButton.innerHTML = '<i class="fas fa-random mr-2"></i>å¼€å§‹éšæœºç‚¹å';
                startButton.classList.remove('bg-red-500', 'hover:bg-red-600');
                startButton.classList.add('bg-pink-500', 'hover:bg-pink-600');
                
                displayElement.classList.remove('random-call-animation');
                displayElement.classList.add('bounce');
                
                setTimeout(() => {
                    displayElement.classList.remove('bounce');
                }, 1000);
                
                clearInterval(randomCallInterval);
                
                // é«˜äº®æ˜¾ç¤ºé€‰ä¸­çš„å­¦ç”Ÿ
                const selectedStudent = displayElement.textContent;
                const studentCards = document.querySelectorAll('.student-card');
                studentCards.forEach(card => {
                    const studentName = card.querySelector('.text-xl').textContent;
                    if (studentName === selectedStudent) {
                        card.classList.add('selected-student');
                    } else {
                        card.classList.remove('selected-student');
                    }
                });
                
                showMessage(`éšæœºç‚¹åç»“æœ: ${selectedStudent}`, 'success');
            }
        }
    </script>
</body>
</html>